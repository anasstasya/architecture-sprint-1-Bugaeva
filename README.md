# Спринт №1

---

---

## Задание 1

---

Для реализации микро-фронтэндов используется инструмент Module Federation (MF).
> Решение было выбрано из-за того, что команда знакома с этим инструментом,
> так же было принято решение, что все реализации микрофронтендов будут использовать библиотеку React.

---

## Сервис `auth-mf`

Сервис отвечает за процесс Логина, Регистрации и проверку актуальности токена.

**События:**

- Публикует:
    - onLogin(userToken) - возникает при успешном логине пользователя
    - onLoginFail(error) - если в процессе логина возникла ошибка
    - onRegister() - при успешной регистрации пользователя
    - onRegisterFail(error) - при возникновении ошибки при регистрации пользователя

**Компоненты:**

- Открытые:
    - Login - отображение формы логина
    - Register - отображение формы регистрации

**API**

- checkToken(token) - проверка валидности сохраненного токена

---

## Сервис `profile-mf`

Сервис отвечает за предоставление информации о пользователе, редактирования профиля, загрузки аватара.

**События:**

- Публикует:
    - onUserUpdated({userData}) - событие возникает при обновлении профиля пользователя (данные, аватар)

**Компоненты:**

- Открытые:
    - Profile - отображение секции профилем пользователя
- Внутренние:
    - EditAvatarPopup - попап с формой редактирования аватара
    - EditProfilePopup - попап с формой редактирования профиля

---

## Сервис `places-mf`

Сервис отвечает за отображение списка, добавление, удаление карточек с фотографиями, а также установку лайков.

**События:**

- Слушает:
    - onAddPlaceClick - открывает попап с формой добавления карточки

**Компоненты:**

- Открытые:
    - Places - отображение секции со списком карточек
- Внутренние:
    - Card - отображение конкретной карточки
    - AddPlacePopup - отображение формы добавления карточки 

## Библиотека компонентов пользовательского интерфейса `ui`

Общие компоненты UI, которые могут использоваться различными микросервисами

**Компоненты:**

- Открытые:
    - PopupWithForm - компонент обертка для попапов
    - InfoTooltip - всплывающее сообщение
    - ImagePopup - всплывающее окно для отображения изображения

## Как работает приложение

- Подключены модули `auth-mf`, `places-mf`, `profile-mf`, `ui-lib`.

### Логика аутентификации и проверки токена
- После монтирования основного компонента проверяется наличие сохранённого токена.
- Если токен есть, выполняется его проверка на валидность с помощью функции `checkToken` из микрофронтенда `auth-mf`.
- Параллельно с проверкой токена загружаются данные о пользователе, если токен валидный.
- Если токена нет или он недействителен, основной контент не отображается. Пользователю предлагается форма логина или регистрации, импортируемая из `auth-mf`.

### Взаимодействие модулей при логине
- При успешной авторизации генерируется событие `onLogin(userToken)`, на которое подписано основное приложение.
- Основное приложение проверяет токен, загружает информацию о пользователе и отображает микрофронтэнды `profile-mf` и `places-mf`.

### Работа с профилем и карточками мест
- В компоненте профиля `profile-mf` есть кнопка для добавления новой карточки.
- При нажатии на кнопку генерируется событие `onAddPlaceClick`, которое обрабатывается микрофронтендом `places-mf` и вызывает отображение формы добавления карточки.
- Действия с карточками (лайки, редактирование, удаление) полностью инкапсулированы в модуле `places-mf`.

### Управление профилем пользователя
- Редактирование профиля и аватара пользователя происходит в модуле `profile-mf`.

### Общие компоненты
- В библиотеку общих компонентов `ui-lib` вынесены элементы, которые используются в `profile-mf`, `places-mf` и основном приложении.
- Все общие компоненты имеют общие правила CSS стилей.

---

---

## Задание 2

---

# Инфраструктура торговой площадки

## 1. Портал электронной площадки

Фронтэнд для продавцов и покупателей.

## 2. BFF Портала

Бэкенд для фронтэнда продавцов и покупателей. Выполняет функции проверки токенов доступа, прав доступа, маршрутизации запросов.

2.1 **Зарегистрироваться на площадке** - пользователь заполняет форму регистрации и отправляет данные (Электронная почта, Номер телефона, Имя). Сервис "Пользователи и доступ" проверяет полученные данные на корректность, создает запись в БД, присваивает роль, статус, и сохраняет дату регистрации, после этого возвращает статус, что учётка создана успешно, иначе - статус ошибки.

2.2 **Выполнить вход на площадку** - пользователь заполняет реквизиты доступа (Адрес эл. почты, пароль), сервис "Пользователи и доступ" проверяют данные, роль, статус и при успешной проверке выпускаем JWT-токен, сохраняем в БД, и возвращает пользователю, клиент пользователя сохраняет токен на своей стороне и отправляет его с последующими запросам к бэку.

2.3 **Редактировать профиль** - пользователь редактирует данные в своем профиле, отправляет запрос, "BFF Портала" валидирует токен и отправляет данные в сервис "Пользователи и доступ".

2.4 **Разместить услугу** - заполняет форму описание услуги, "BFF Портала" проверяет JWT-токен, отправляет данные в сервис "Товары и услуги", публикует сообщение о "Размещении услуги", подписчики: сервис "Статистика".

2.5 **Разместить товар** - заполняет форму описание товара, "BFF Портала" проверяет JWT-токен, отправляет данные в сервис "Товары и услуги", публикует сообщение о "Размещении товара", подписчики: сервис "Статистика".

2.6 **Поиск по каталогу товаров/услуг** - запрос перенаправляется к сервису "Поиск товаро иу услуг".

2.7 **Размещение заказа** - через портал электронной площадки поступает запрос на размещение заказа.

2.8 **Получение уведомлений** - для отображения уведомлений пользователя, запрашиваем сервис "Уведомления".

2.9 **Взаимодействие с сервисом Аукционы**
- Создать аукцион
- Подать заявку на аукцион

2.10 **Взаимодействие с сервисом Апеляции** - подача заявки на апеляцию.

---

## 3. Сервис **"Пользователи и доступ"**

Сервис для хранения пользовательских данных, управления ролями, статусами и системой аутентификации.

3.1 Публикуется сообщение "**Успешный вход пользователя**", подписчики: сервис "Статистика".

3.2 При успешной регистрации публикуем событие в брокере сообщений "**Регистрация пользователя**", подписчики: сервис "Уведомления", "Статистика".

---

## 4. Сервис **"Уведомления"**

Занимается отправкой уведомлений различными каналами пользователям, администраторам и сотрудникам тех. поддержки.

4.1 Слушает сообщения для отправки соответствующих уведомлений:

    - Новый пользователь
    - Создание заказа
    - Изменился статус оплаты (успешная оплата, сбой оплаты, возврат)

## 5. Сервис **"Товары и услуги"**

CRUD сервис для хранения товаров и услуг.

5.1 При добавлении, редактировании, удаления услуг и товаров публикует соответствующие сообщения (Товар добавлен/изменился/удален, Услуга добавлена/изменилась/удалена) в брокере сообщений, подписчики: сервис "6. Поиск товаров и услуг", "Статистика".

## 6. Сервис **"Поиск товаров и услуг"**

Сервис предназначен для быстрой фильтрации выдаци результатов поиска, позволяет масштабировать нагрузку на каталог.

6.1 Подписан на сообщения (**Товар добавлен/изменился/удален**, **Услуга добавлена/изменилась/удалена**) в брокере сообщений, для своевременного обновления своего индекса.

6.2 Получение информации о товарах и услугах - когда сервис получает сообщение, что что-то изменилось в каталоге товаров и услуг, отправляет запрос на получение детальной иформации по конкретной записи в каталоге, чтобы внести изменения в свой индекс.

## 7. Сервис **"Оформления заказов"**

Сервис предназначен для бизнес-логики размещения, валидации, оркестрации процесса офомрления заказов: (Проверка остатков, резервирование остатков, инициализация оплат, сохранения заказа).

7.1 **Проверка наличия** - проверка наличия в сервисе **Товары и услуги**

7.2 **Инициализировать платеж** - инициализируем операцию оплаты.

7.3 **Проверка статуса оплаты** - проверка статуса оплаты.

7.4 **Отмена оплаты** - отмена оплаты.

7.5 **Сохранение заказа** - отмена оплаты.

7.6 **Публикация сообщений** - При изменении статуса заказа публикует сообщения: (новый заказа, отмена, доставлен, выполнен).

7.7 **Изменение статуса оплаты** - Подписывается на сообщение изменения статуса оплаты, для выполнения действий бизнес-логики.

## 8. Сервис **"Заказы"**

Сервис отвечает за хранение заказов, отображение детализации по заказам, отображение листингов.

## 9. Сервис **"Платежи"**

Сервис обрабатывает платежи: создание, отмены, возвраты, обменивается с платёжными шлюзами статусами, при каждом изменении статусов операций, публикует сообщение в брокер сообщений.

9.1 **Изменился статус операции** - при изменении статуса операции публикует сообщение.

9.2 **Запрос на создание операции оплаты** - делает запрос в соответствующую платежную систему согласно выбранному типу оплаты.

9.3 **Запрос статуса операции** - запрос в определенную платежную систему для получения статуса.

9.4 **Отмена/возврат платежа** - запрос на платежный шлюз для отмены или возврата оплаты.

## 10. Панель управления площадкой

Клиентская часть (веб-клиент) для администраторов площадки.
Предоставляет доступ к функциям управления площадкой, просмотра статистики и отчетов.

## 11. Панель технической поддержки

Клиентская часть (веб-клиент) для службы тех. поддержки. Взаимодействует с АПИ **16. BFF панели тех. поддержки**

## 12. Аукционы

Сервис хранения, управления аукционами.

12.1 Публикация сообщений в брокере при изменении статуса аукциона, создании аукциона, изменении статуса заявки на аукцион.

## 13. Апеляции

Сервис хранения, управления апеляциями.

13.1 Публикация сообщений в брокере сообщений при изменении статуса апеляции, создании апеляции, изменении статуса заявки на апеляцию.

## 14. Заявки тех. поддержки

Хранение, управление заявками на тех. поддержку.

14.1 Публикация сообщения, что создана заявка на тех. поддержку.

## 15. Статистика и отчеты

Сервис подписан на сообщения системы, ведет лог сообщений, так же готовит отчеты по требованию.

15.1 Публикация сообщения, что создана заявка на тех. поддержку.

15.2 При генерации отчетов статистика заказов обращается в сервис заказов за детализацией.

## 16. BFF для пользователей тех. поддержки

Обеспечивает маршрутизацию, контроль доступа (проверка ролей) службы тех. поддержки, отображение уведомлений для пользователей.
В будущем можно расширить функционал подключая новые функции.

16.1 Получение уведомлений из сервиса "Уведомления" о изменении статуса зайвки на поддержу.

16.2 Пользователь тех. поддержки регистрирует заявку на тех. поддержку.

16.3 Вход пользователя.

## 17. BFF для администратора

Контроль доступа (проверка ролей) администраторов, отображение уведомлений, АПИ для клиентской части "Панели управления Администратора", маршрутизация запросов.
Функционал может быть расширен дополнительными функциями.

17.1 Получение уведомлений из сервиса "Уведомления" о новых заказах, пользователях и т.п.

17.2 Изменить статус заявки на апеляцию в сервисе апеляций.

17.3 Вход пользователя.

17.4 Доступ к сервису отчетов и статистики.