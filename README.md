Оглавление

[Задание 1](#Задание-1-Разделить-проект-Mesto-на-несколько-микрофронтендов)
[Задание 2](#Задание-2-Декомпозиция-веб-приложения-на-Django-на-микросервисы)

# Задание 1 Разделить проект Mesto на несколько микрофронтендов

## Уровень 1. Проектирование

 Уровень проектирования оформил по шагам, как описаны в теории.   

### Этапы монолитного фронтенда на микрофронтенды

#### 1 этап. Предва# Задание 2. Декомпозиция веб-приложения на Django на микросервисырительный анализ

Цели перехода проекта Mesto на микрофронты: 

- разбить проект на модули, которыми будут заниматься разные команды;
- сделать его более маштабируемым, для более быстрой интеграции новых фич;
- повышение отказаустойчивости.

Приложение не сложное и масштаб доработок будет не очень большой.

Команда неопытная (я), но справится.

#### 2 этап. Проектирования микрофронтендов

Разделим функции приложения на разные доменные области. 

**Первая область**, работа с профилем пользователя. Сюда относится функции:

- создание профиля;

- регистрация;

- авторизация

- выход из сессии;

- редактирование профиля:
  
  - изменение аватарки
  
  - изменение подписи;

- удаление профиля.

**Вторая область**, это основной бизнес функционал приложения - Галерея фотографий. Предоставлят следующий функционал:

- добавление фотографии авторизированным пользователем;

- удаление фотографии пользователем, который ее добавил или администратором;

- редактирование сопроводитольной информации к фотографии пользователем, который ее добавил или администратором.

**Третья область**. Сбор и учет лайков и статистики. Данный модуль реализует функционал:

- регистрация лайка пользователя (зарегистрированного или нет) под фотографией;

- регистрация удаления лайка пользователя (зарегистрированного или нет) под фотографией;

- предоставление статистики по фотографиям: 
  
  - количество лайков под фотографией;
  
  - популярность фотографий;
  
  - популярность пользователей;

#### 3 этап. Выбор метода реализации

 Run time объединение во время выполнения с ленивой загрузкой. 

#### 4 этап. Выбор фреймворка

Для данной доработки выбран фреймворк Webpack Module Federation по следующим причинам:

- позволяет разбить фронт на отдельные запускаемые микрофронтенды;

- эти микрофронтенды будут исользовать общий код;

- приложение одностраничное и хост соберет в runtime приложение из разделенных микрофронтов;

- пока нет необходимости в микрофронтендах на разных фреймворках -пилим текущий.

## Уровень 2. Планирование изменений

В директории **frontend** есть еще одна директория **microfrontend**. В ней буду создавать новый проект.

### Проект general

Первый проект **general** - это проект типа **Library**, котрый будет содержать общие компоненты и модули, используемые в проекте. В дальнейшем это позволит централизовано изменять общие компоненты и например внедрить кастомизацию по скинам. Я не уверен что правльно выбрал тип проекта. 

В данный проект я перенес компонет PopupWithForm и связанные с ним стили.

general
├── package.json    
├── src
│   ├── blocks                                - стили проекта
│   │   └── popup
│   ├── components                     - компоненты
│   │   └── PopupWithForm.js     - шаблон попапа 
│   └── index.css                           - подключение стилей
└── tsconfig.json 

### Проект host

Основной проект, который собирает все компоненты вместе. 

host
├── src
│   ├── App.tsx                    - основное приложение
│   ├── blocks                      - стили приложения
│   │   ├── content              - стили страницы  
│   │   ├── footer                 - стили подвала
│   │   ├── header               - стили заголовка
│   │   └── page                   - стили сраницы
│   ├── components
│   │   ├── Footer.js            - сборка футера
│   │   ├── Header.js          - сборка заголовка
│   │   └── Main.js               - 
│   ├── contexts                 - контекст   
│   ├── images                    - рисунки
│   ├── index.css                
│   ├── index.ts
│   └── vendor                    - шрифты и стили
└── tsconfig.json

### Проект users

Реализует логику пользователей.

users
├── src
│   ├── blocks                - подключение стилей
│   │   ├── auth-form    - стили для формы авторизации
│   │   ├── header         - стили для отображения плашки регистрации или пользователя в заголовке   
│   │   └── login             - стили для логина
│   ├── components
│   │   ├── EditAvatarPopup.js    - попап редактирования аватара
│   │   ├── EditProfilePopup.js    - попап реджактирования профиля
│   │   ├── Login.js                         - форма логина 
│   │   ├── Register.js                    - форма регистрации на сайте
│   │   └── UserHeaderControl.js - отображение профиля в заголовке
│   ├── index.css                            - подключение стилей
│   ├── index.ts
│   └── utils                                    - дополнительные модули
│       ├── api.js
│       └── auth.js
└── tsconfig.json

### Проект places

Проект реализует логику работы с карточками и местами. 

places
├── src
│   ├── App.tsx
│   ├── blocks            - стили
│   │   ├── card          - стили для страницы с карточкой места  
│   │   └── places       - стили для места на общей сраницы
│   ├── components
│   │   ├── AddPlacePopup.js    - попап добавления места
│   │   ├── Card.js                        - страница с карточкой места
│   │   └── ImagePopup.js          - попап редактирования фотографии места
│   ├── index.css
│   ├── index.ts
│   └── utils        
│       └── api.js            - утилиты для работы с бекендом
└── tsconfig.json

### Проект likes

Логику по лайкам решил вынести в отдельный модуль, что бы там прикрутить потом статистику по лайкам и расширить активности пользователей.

likes
├── src
│   ├── App.tsx
│   ├── blocks                - стили
│   │   └── card              - стили отображения лайков на карточке  
│   ├── components
│   │   └── CardLikesComponent.js  - компонент встраивается в карточку и отображает лайли и кнопку лайка
│   ├── index.css
│   ├── index.ts
│   └── utils
│       └── api.js            - обращение к бекенду, что бы проставить лайк (changeLikeCardStatus)
└── tsconfig.json

# Задание 2 Декомпозиция веб-приложения на Django на микросервисы

Данное приложения я разделил на 3 системы и 7 микросервисов. Так же был добавлен брокер сообщений Kafka для сбора статистики и нотификации. Все системы и микросервисы отправляют в Kafka данные об изменениях в объектах. На их основе Система Статистики и микросервис Поиска формирует свои данные.

Весь обмен запросами в системе проходит с использованием токенов, которые валидируются Сервисом Безопасности. Этот же сервис предоставляет данные о разграничении прав доступа. 

Все микросервисы масштабируются за счет запуска их в докер-контейнерах за прокси-сервером. 

Микросервисы предлагается делать на Go. База данных PostgreSQL. В Сервисе Администрирования и Поиска предлагаю MongoDB ввиду сложной организации данных, что позволит более гибко подходить к новым версиям данных. В системе Статистики прделагается использовать БД ClickHouse, протому что читал, что столбчатые базы данных используются в основном в такого рода проектах.

Ниже приведено их описание и функции.

[Ссылка на решение](https://viewer.diagrams.net/?tags=%7B%7D&lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=%D0%9C%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B.drawio#Uhttps%3A%2F%2Fraw.githubusercontent.com%2Ftryexceptend%2Farch_template_task2%2Fmain%2F%D0%9C%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D1%8B.drawio)

## 1. Портал электронной коммерции

Веб интерфейс для удобства пользователей остается максимально похожий на предыдущий. Изменяется привязка вызовов от монолита к новым микросервисам.

## 2. Сервис Аукционов

Основной бизнес функционал выделен в данном сервисе. Он реализует работу с аукционами и торговыми площадками. Их создание, размещение товаров, организация торгов. В случае оформления "Заказа", он делает запрос к Сервису Заказов по RESTFull API насоздание заказа. 

## 3. Сервис Заказов

Данный микросервис инкапсулирует всю работу с Заказами. Заказ создается по запросу Сервиса Аукционов. Сервис обрабатывает заказы, проводит оплату через Сервис Платежей, оформляет джоставку и предоставляет данные о заказах другим сервисам и системам.

## 4. Сервис Платежей

Этот микросервис реализует работу со сторонними платежными системами. Он хранит данные о всех платежах пользователей, связывая их с заказами по [Заказ.ID]

Он же предоставляет информацию о заказах другим системам.

## 5. Сервис Безопасности

Этот микросервис организует безопасную коммуникацию между микросервисами и пользователями за счет JWT токена. Так же он предоставляет данные о правах пользователей по [Пользователь.ID]. Все запросы по REST API. Запросы внитри системы так же наверно стоит подписывать токеном.

## 6. Сервис Пользователей

Микросервис хранит данные пользователей системы, их профиль и данные. Отдает их по запросу по REST.

## 7. Система Администрирования

Для специалистов поддержки и администраторов выделена отдельная система Администрирования. В ней реализованы следующие разделы:

- система заявок в техподдержу

- система администрирования всей системы

- система мониторинга состояния всей системы

Я внес сюда функции мониторинга системы, но можно выделить их и в отдельную систему на уровне девопсов. Это стделано для того, что бы подчеркнуть важность мониторинга и контроля сложной системы. 

## 8. Система Статистики

Данная система собирает информацию об бизнес объетах в системе через брокер сообщений Kafka. Все системы и микросервисы публикуют сообщения об изменениях в объектах в топики. Система их забирает и формирует свою БД. Веб интерфейс предоставляет доступ к собранной статистики и формирование отчетов по бизнец процессам.

## 9. Сервис Поиска

Собирает данные об объектах в системе, формирует свою базу данных и организует быстрый поиск по этим объектам. Базу данных использует MongoDb потому что алгоритмы поиска требуют частых изменений в структуре данных.

## 10. Сервис Нотификации

Через брокер сообщений получает данные об уведомлениях от других систем и сервисов и отправляет их пользователям и сотрудникам. 
