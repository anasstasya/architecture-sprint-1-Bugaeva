# Реализация проекта MESTO

## Уровень 1. Проектирование

Для реализации микро-фронтэндов используется инструмент Module Federation (MF).
> Решение было выбрано из-за того, что команда знакома с этим инструментом,
> так же было принято решение, что все реализации микрофронтендов будут использовать библиотеку React.

---

## Сервис `auth-mf`

Сервис отвечает за процесс Логина, Регистрации и проверку актуальности токена.

**События:**

- Публикует:
    - onLogin(userToken) - возникает при успешном логине пользователя
    - onLoginFail(error) - если в процессе логина возникла ошибка
    - onRegister() - при успешной регистрации пользователя
    - onRegisterFail(error) - при возникновении ошибки при регистрации пользователя

**Компоненты:**

- Открытые:
    - Login - отображение формы логина
    - Register - отображение формы регистрации

**API**

- checkToken(token) - проверка валидности сохраненного токена

---

## Сервис `profile-mf`

Сервис отвечает за предоставление информации о пользователе, редактирования профиля, загрузки аватара.

**События:**

- Публикует:
    - onUserUpdated({userData}) - событие возникает при обновлении профиля пользователя (данные, аватар)

**Компоненты:**

- Открытые:
    - Profile - отображение секции профилем пользователя
- Внутренние:
    - EditAvatarPopup - попап с формой редактирования аватара
    - EditProfilePopup - попап с формой редактирования профиля

---

## Сервис `places-mf`

Сервис отвечает за отображение списка, добавление, удаление карточек с фотографиями, а также установку лайков.

**События:**

- Слушает:
    - onAddPlaceClick - открывает попап с формой добавления карточки

**Компоненты:**

- Открытые:
    - Places - отображение секции со списком карточек
- Внутренние:
    - Card - отображение конкретной карточки
    - AddPlacePopup - отображение формы добавления карточки 

## Библиотека компонентов пользовательского интерфейса `ui`

Общие компоненты UI, которые могут использоваться различными микросервисами

**Компоненты:**

- Открытые:
    - PopupWithForm - компонент обертка для попапов
    - InfoTooltip - всплывающее сообщение
    - ImagePopup - всплывающее окно для отображения изображения

## Как работает приложение

- Подключены модули `auth-mf`, `places-mf`, `profile-mf`, `ui-lib`.

### Логика аутентификации и проверки токена
- После монтирования основного компонента проверяется наличие сохранённого токена.
- Если токен есть, выполняется его проверка на валидность с помощью функции `checkToken` из микрофронтенда `auth-mf`.
- Параллельно с проверкой токена загружаются данные о пользователе, если токен валидный.
- Если токена нет или он недействителен, основной контент не отображается. Пользователю предлагается форма логина или регистрации, импортируемая из `auth-mf`.

### Взаимодействие модулей при логине
- При успешной авторизации генерируется событие `onLogin(userToken)`, на которое подписано основное приложение.
- Основное приложение проверяет токен, загружает информацию о пользователе и отображает микрофронтэнды `profile-mf` и `places-mf`.

### Работа с профилем и карточками мест
- В компоненте профиля `profile-mf` есть кнопка для добавления новой карточки.
- При нажатии на кнопку генерируется событие `onAddPlaceClick`, которое обрабатывается микрофронтендом `places-mf` и вызывает отображение формы добавления карточки.
- Действия с карточками (лайки, редактирование, удаление) полностью инкапсулированы в модуле `places-mf`.

### Управление профилем пользователя
- Редактирование профиля и аватара пользователя происходит в модуле `profile-mf`.

### Общие компоненты
- В библиотеку общих компонентов `ui-lib` вынесены элементы, которые используются в `profile-mf`, `places-mf` и основном приложении.
- Все общие компоненты имеют общие правила CSS стилей.